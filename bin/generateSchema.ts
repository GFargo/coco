import * as fs from 'fs'
import * as TJS from 'ts-json-schema-generator'

const config = {
  tsconfig: 'tsconfig.json',
  type: 'ConfigWithServiceObject',
  schemaId: 'http://git-co.co/schema.json',
  skipTypeCheck: false,
} as TJS.Config

const schema = TJS.createGenerator(config).createSchema(config.type)
const schemaString = JSON.stringify(schema, null, 2)

if (!schemaString) {
  console.error('Error generating schema')
  process.exit(1)
}

// Write the schema to a file with error handling
try {
  // write the schema to a file
  fs.writeFileSync('schema.json', schemaString)

  // write the schema variable out to a typescript file in /src/lib/schema.ts
  fs.writeFileSync(
    'src/lib/schema.ts',
    `// this file is auto-generated by the 'build:schema' script
export const SCHEMA_PUBLIC_URL = ${JSON.stringify(schema.$id)}
export const schema = ${schemaString}`
  )

  console.log('schema.json & schema.ts generated successfully!')
} catch (error) {
  console.error('Error generating schema.json:', error)
}
